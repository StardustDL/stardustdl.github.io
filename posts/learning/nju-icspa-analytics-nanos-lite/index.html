<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æ¦‚è¿°  æ¡†æ¶ä»£ç åº“ CPU æ¶æ„ï¼šx64 æ“ä½œç³»ç»Ÿ: GNU/Linux ç¼–è¯‘å™¨: GCC ç¼–ç¨‹è¯­è¨€ï¼šC è¯­è¨€  Nanos-liteæ˜¯å—äº¬å¤§å­¦æ“ä½œç³»ç»ŸNanosçš„è£å‰ªç‰ˆã€‚å¯è¿è¡Œåœ¨ x86-nemu çš„ AM ä¸Šã€‚
æ¡†æ¶ä»£ç ç»“æ„ nanos-lite/ # NANOS-LITE é¡¹ç›® include/ # å¤´æ–‡ä»¶ src/ # æºæ–‡ä»¶ device.c # è®¾å¤‡æŠ½è±¡ fs.c # æ–‡ä»¶ç³»ç»Ÿ files.h # ramdisk ä¸­çš„æ–‡ä»¶æè¿° initrd.S # ramdiskè®¾å¤‡ irq.c # ä¸­æ–­å¼‚å¸¸å¤„ç† loader.c # åŠ è½½å™¨ main.c # ä¸»ç¨‹åº mm.c # å­˜å‚¨ç®¡ç† proc.c # è¿›ç¨‹è°ƒåº¦ ramdisk.c # ramdiské©±åŠ¨ç¨‹åº syscall.c # ç³»ç»Ÿè°ƒç”¨å¤„ç† syscall.h # ç³»ç»Ÿè°ƒç”¨ç›¸å…³å® Makefile navy-apps/ nemu/ nexus-am/ include/ common."><title>NJU ICS Programming Assignment ä»£ç åˆ†æ - NANOS-LITE</title><link rel=canonical href=https://stardustdl.github.io/posts/learning/nju-icspa-analytics-nanos-lite/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="NJU ICS Programming Assignment ä»£ç åˆ†æ - NANOS-LITE"><meta property="og:description" content="æ¦‚è¿°  æ¡†æ¶ä»£ç åº“ CPU æ¶æ„ï¼šx64 æ“ä½œç³»ç»Ÿ: GNU/Linux ç¼–è¯‘å™¨: GCC ç¼–ç¨‹è¯­è¨€ï¼šC è¯­è¨€  Nanos-liteæ˜¯å—äº¬å¤§å­¦æ“ä½œç³»ç»ŸNanosçš„è£å‰ªç‰ˆã€‚å¯è¿è¡Œåœ¨ x86-nemu çš„ AM ä¸Šã€‚
æ¡†æ¶ä»£ç ç»“æ„ nanos-lite/ # NANOS-LITE é¡¹ç›® include/ # å¤´æ–‡ä»¶ src/ # æºæ–‡ä»¶ device.c # è®¾å¤‡æŠ½è±¡ fs.c # æ–‡ä»¶ç³»ç»Ÿ files.h # ramdisk ä¸­çš„æ–‡ä»¶æè¿° initrd.S # ramdiskè®¾å¤‡ irq.c # ä¸­æ–­å¼‚å¸¸å¤„ç† loader.c # åŠ è½½å™¨ main.c # ä¸»ç¨‹åº mm.c # å­˜å‚¨ç®¡ç† proc.c # è¿›ç¨‹è°ƒåº¦ ramdisk.c # ramdiské©±åŠ¨ç¨‹åº syscall.c # ç³»ç»Ÿè°ƒç”¨å¤„ç† syscall.h # ç³»ç»Ÿè°ƒç”¨ç›¸å…³å® Makefile navy-apps/ nemu/ nexus-am/ include/ common."><meta property="og:url" content="https://stardustdl.github.io/posts/learning/nju-icspa-analytics-nanos-lite/"><meta property="og:site_name" content="StardustDL's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="NJU"><meta property="article:published_time" content="2018-11-05T17:30:22+08:00"><meta property="article:modified_time" content="2018-11-05T17:30:22+08:00"><meta name=twitter:title content="NJU ICS Programming Assignment ä»£ç åˆ†æ - NANOS-LITE"><meta name=twitter:description content="æ¦‚è¿°  æ¡†æ¶ä»£ç åº“ CPU æ¶æ„ï¼šx64 æ“ä½œç³»ç»Ÿ: GNU/Linux ç¼–è¯‘å™¨: GCC ç¼–ç¨‹è¯­è¨€ï¼šC è¯­è¨€  Nanos-liteæ˜¯å—äº¬å¤§å­¦æ“ä½œç³»ç»ŸNanosçš„è£å‰ªç‰ˆã€‚å¯è¿è¡Œåœ¨ x86-nemu çš„ AM ä¸Šã€‚
æ¡†æ¶ä»£ç ç»“æ„ nanos-lite/ # NANOS-LITE é¡¹ç›® include/ # å¤´æ–‡ä»¶ src/ # æºæ–‡ä»¶ device.c # è®¾å¤‡æŠ½è±¡ fs.c # æ–‡ä»¶ç³»ç»Ÿ files.h # ramdisk ä¸­çš„æ–‡ä»¶æè¿° initrd.S # ramdiskè®¾å¤‡ irq.c # ä¸­æ–­å¼‚å¸¸å¤„ç† loader.c # åŠ è½½å™¨ main.c # ä¸»ç¨‹åº mm.c # å­˜å‚¨ç®¡ç† proc.c # è¿›ç¨‹è°ƒåº¦ ramdisk.c # ramdiské©±åŠ¨ç¨‹åº syscall.c # ç³»ç»Ÿè°ƒç”¨å¤„ç† syscall.h # ç³»ç»Ÿè°ƒç”¨ç›¸å…³å® Makefile navy-apps/ nemu/ nexus-am/ include/ common."><link rel="shortcut icon" href=/favicon.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-111573521-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="article-page keep-sidebar"><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/assets/images/avatar_hu55fbf1db337484ccbc1a7220a4594f60_220509_300x0_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>ğŸ¥</span></figure><h1 class=site-name><a href=https://stardustdl.github.io/>StardustDL's Blog</a></h1><h2 class=site-description></h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/learning/>Learning</a></header><h2 class=article-title><a href=/posts/learning/nju-icspa-analytics-nanos-lite/>NJU ICS Programming Assignment ä»£ç åˆ†æ - NANOS-LITE</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Nov 05, 2018</time></footer></div></header><section class=article-content><h1 id=æ¦‚è¿°>æ¦‚è¿°</h1><ul><li><a class=link href=https://github.com/NJU-ProjectN/nanos-lite target=_blank rel=noopener>æ¡†æ¶ä»£ç åº“</a></li><li>CPU æ¶æ„ï¼šx64</li><li>æ“ä½œç³»ç»Ÿ: GNU/Linux</li><li>ç¼–è¯‘å™¨: GCC</li><li>ç¼–ç¨‹è¯­è¨€ï¼šC è¯­è¨€</li></ul><p>Nanos-liteæ˜¯å—äº¬å¤§å­¦æ“ä½œç³»ç»ŸNanosçš„è£å‰ªç‰ˆã€‚å¯è¿è¡Œåœ¨ x86-nemu çš„ AM ä¸Šã€‚</p><h2 id=æ¡†æ¶ä»£ç ç»“æ„>æ¡†æ¶ä»£ç ç»“æ„</h2><pre><code>nanos-lite/                 # NANOS-LITE é¡¹ç›®
    include/                # å¤´æ–‡ä»¶
    src/                    # æºæ–‡ä»¶
        device.c            # è®¾å¤‡æŠ½è±¡
        fs.c                # æ–‡ä»¶ç³»ç»Ÿ
        files.h             # ramdisk ä¸­çš„æ–‡ä»¶æè¿°
        initrd.S            # ramdiskè®¾å¤‡
        irq.c               # ä¸­æ–­å¼‚å¸¸å¤„ç†
        loader.c            # åŠ è½½å™¨
        main.c              # ä¸»ç¨‹åº
        mm.c                # å­˜å‚¨ç®¡ç†
        proc.c              # è¿›ç¨‹è°ƒåº¦
        ramdisk.c           # ramdiské©±åŠ¨ç¨‹åº
        syscall.c           # ç³»ç»Ÿè°ƒç”¨å¤„ç†
        syscall.h           # ç³»ç»Ÿè°ƒç”¨ç›¸å…³å®
    Makefile
navy-apps/
nemu/
nexus-am/
</code></pre><h1 id=include>include/</h1><h2 id=commonh>common.h</h2><p>å¼•ç”¨ AM ä¸­çš„ <code>am.h klib.h</code>ã€‚</p><h2 id=debugh>debug.h</h2><p>ç®€åŒ–è°ƒè¯•è¾“å‡ºçš„å®ï¼Œå¯ç±»æ¯” <code>nemu/debug.h</code>ã€‚</p><h2 id=fsh>fs.h</h2><p>æ–‡ä»¶ç³»ç»Ÿçš„ç›¸å…³å†…å®¹ã€‚</p><p>LSEEK ç±»å‹æšä¸¾ï¼š</p><table><thead><tr><th>æšä¸¾</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>SEEK_SET</code></td><td>å°†æ–‡ä»¶æµä½ç½®è®¾ç½®ä¸ºæŒ‡å®šå€¼</td></tr><tr><td><code>SEEK_CUR</code></td><td>å°†æ–‡ä»¶æµä½ç½®è®¾ç½®ä¸ºå½“å‰ä½ç½®å‘ååç§»æŒ‡å®šå€¼</td></tr><tr><td><code>SEEK_END</code></td><td>å°†æ–‡ä»¶æµä½ç½®è®¾ç½®æ–‡ä»¶æœ«å°¾</td></tr></tbody></table><p>æ–‡ä»¶ç³»ç»Ÿæ“ä½œå‡½æ•°ï¼š</p><table><thead><tr><th>å‡½æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>fs_open</code></td><td>æ‰“å¼€æ–‡ä»¶ï¼Œè¿”å› ID</td></tr><tr><td><code>fs_read</code></td><td>è¯»å–æ–‡ä»¶</td></tr><tr><td><code>fs_write</code></td><td>å†™å…¥æ–‡ä»¶</td></tr><tr><td><code>fs_lseek</code></td><td>æ”¹å˜æ–‡ä»¶æµä½ç½®</td></tr><tr><td><code>fs_close</code></td><td>å…³é—­æ–‡ä»¶</td></tr><tr><td><code>fs_filesz</code></td><td>è·å–æ–‡ä»¶å¤§å°</td></tr></tbody></table><h1 id=src>src/</h1><h2 id=mainc>main.c</h2><p>NANOS-LITE ä¸»ç¨‹åºã€‚</p><ul><li>åˆå§‹åŒ–å­˜å‚¨ ï¼ˆ<code>init_mm</code>ï¼‰</li><li>åˆå§‹åŒ–é•œåƒæ–‡ä»¶ ï¼ˆ<code>init_ramdisk</code>ï¼‰</li><li>åˆå§‹åŒ–è®¾å¤‡ ï¼ˆ<code>init_device</code>ï¼‰</li><li>åˆå§‹åŒ–ä¸­æ–­å¤„ç† ï¼ˆ<code>init_irq</code>ï¼‰</li><li>åˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿ ï¼ˆ<code>init_fs</code>ï¼‰</li><li>åˆå§‹åŒ–è¿›ç¨‹ ï¼ˆ<code>init_proc</code>ï¼‰<ul><li>ä» <code>ramdist</code> ä¸­åŠ è½½ç¨‹åºé•œåƒåˆ°æŒ‡å®šä½ç½®</li><li>å¯åŠ¨è¿›ç¨‹</li></ul></li><li>æµ‹è¯•è‡ªé™·äº‹ä»¶ï¼ˆ<code>_yield</code>ï¼‰</li></ul><h2 id=ramdiskc>ramdisk.c</h2><p>å˜é‡ <code>ramdisk_start,ramdisk_end</code> æŒ‡ç¤º ramdisk æ‰€åœ¨çš„å†…å­˜åŒºé—´ã€‚
å® <code>RAMDISK_SIZE</code> æŒ‡ç¤º ramdisk å¯¹åº”å†…å­˜å¤§å°ã€‚</p><p>ramdisk ç›¸å…³æ“ä½œå‡½æ•°ã€‚</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=c1>// åˆå§‹åŒ– ramdisk
</span><span class=c1></span><span class=kt>void</span> <span class=nf>init_ramdisk</span><span class=p>();</span>

<span class=c1>// ä»ramdiskä¸­ offset åç§»å¤„çš„ len å­—èŠ‚è¯»å…¥åˆ° buf ä¸­
</span><span class=c1></span><span class=n>size_t</span> <span class=nf>ramdisk_read</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>offset</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>len</span><span class=p>);</span>

<span class=c1>// æŠŠ buf ä¸­çš„ len å­—èŠ‚å†™å…¥åˆ°ramdiskä¸­ offset åç§»å¤„
</span><span class=c1></span><span class=n>size_t</span> <span class=nf>ramdisk_write</span><span class=p>(</span><span class=k>const</span> <span class=kt>void</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>offset</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>len</span><span class=p>);</span>

<span class=c1>// è¿”å›ramdiskçš„å¤§å°, å•ä½ä¸ºå­—èŠ‚
</span><span class=c1></span><span class=n>size_t</span> <span class=nf>get_ramdisk_size</span><span class=p>();</span>
</code></pre></div><h2 id=fsc>fs.c</h2><p>æ–‡ä»¶ç³»ç»Ÿç›¸å…³ã€‚å®ç°äº† <code>fs.h</code> ä¸­å®šä¹‰çš„å‡½æ•°ã€‚</p><ul><li><p><code>init_fs</code> åˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿ</p><ul><li>åˆå§‹åŒ– <code>FD_FB</code> æ–‡ä»¶çš„å¤§å°ï¼ˆæ ¹æ® VGA å±å¹•å¤§å°ï¼‰</li></ul></li><li><p><code>ReadFn</code> ç±»å‹ï¼šVFS é€šç”¨æ–‡ä»¶è¯»å–å‡½æ•°ç±»å‹</p></li><li><p><code>WriteFn</code> ç±»å‹ï¼šVFS é€šç”¨æ–‡ä»¶å†™å…¥å‡½æ•°ç±»å‹</p></li></ul><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>typedef</span> <span class=nf>size_t</span> <span class=p>(</span><span class=o>*</span><span class=n>ReadFn</span><span class=p>)</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>offset</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>len</span><span class=p>);</span>
<span class=k>typedef</span> <span class=nf>size_t</span> <span class=p>(</span><span class=o>*</span><span class=n>WriteFn</span><span class=p>)</span> <span class=p>(</span><span class=k>const</span> <span class=kt>void</span> <span class=o>*</span><span class=n>buf</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>offset</span><span class=p>,</span> <span class=n>size_t</span> <span class=n>len</span><span class=p>);</span>
</code></pre></div><p>ç”¨äºç¦ç”¨æ–‡ä»¶è¯»å†™çš„å‡½æ•°ï¼š</p><ul><li><code>invalid_read</code> éæ³•è¯»å–</li><li><code>invalid_write</code> éæ³•å†™å…¥</li></ul><h3 id=æšä¸¾>æšä¸¾</h3><p>ç‰¹æ®Šæ–‡ä»¶ç±»å‹æšä¸¾ã€‚</p><table><thead><tr><th>æšä¸¾</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FD_STDIN</code></td><td>æ ‡å‡†è¾“å…¥</td></tr><tr><td><code>FD_STDOUT</code></td><td>æ ‡å‡†è¾“å‡º</td></tr><tr><td><code>FD_STDERR</code></td><td>æ ‡å‡†é”™è¯¯è¾“å‡º</td></tr><tr><td><code>FD_FB</code></td><td>æ˜¾å­˜</td></tr></tbody></table><h3 id=ç»“æ„ä½“-finfo>ç»“æ„ä½“ Finfo</h3><p>æ–‡ä»¶æè¿°ä¿¡æ¯ã€‚</p><table><thead><tr><th>æˆå‘˜</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>name</code></td><td>æ–‡ä»¶å</td></tr><tr><td><code>size</code></td><td>æ–‡ä»¶å¤§å°</td></tr><tr><td><code>dist_offset</code></td><td>åœ¨ ramdisk ä¸­çš„åœ°å€åç§»</td></tr><tr><td><code>open_offset</code></td><td>æ–‡ä»¶æµä½ç½®</td></tr><tr><td><code>read</code></td><td>è¯»å–å‡½æ•°</td></tr><tr><td><code>write</code></td><td>å†™å…¥å‡½æ•°</td></tr></tbody></table><ul><li><code>file_table</code> ä¿å­˜äº†æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯<ul><li><code>files.h</code> å®šä¹‰äº†åœ¨ ramdisk ä¸­çš„æ–‡ä»¶</li></ul></li><li><code>NR_FILES</code> æ–‡ä»¶æ€»æ•°</li></ul><p>ç‰¹æ®Šæ–‡ä»¶ï¼š</p><table><thead><tr><th>æ–‡ä»¶å</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>stdin</code></td><td>æ ‡å‡†è¾“å…¥</td></tr><tr><td><code>stdout</code></td><td>æ ‡å‡†è¾“å‡º</td></tr><tr><td><code>stderr</code></td><td>æ ‡å‡†é”™è¯¯è¾“å‡º</td></tr><tr><td><code>/dev/fb</code></td><td>æ˜¾å­˜</td></tr><tr><td><code>/proc/dispinfo</code></td><td>æ˜¾ç¤ºå™¨ä¿¡æ¯</td></tr><tr><td><code>/dev/events</code></td><td>äº‹ä»¶ï¼ŒåŒ…å«æ—¶é’Ÿå’Œé”®ç›˜ä¿¡å·</td></tr></tbody></table><h2 id=devicec>device.c</h2><p>å°†è®¾å¤‡æŠ½è±¡æˆæ–‡ä»¶çš„å®ç°ã€‚</p><ul><li><code>init_device</code> åˆå§‹åŒ–è®¾å¤‡<ul><li>è°ƒç”¨ <code>_ioe_init()</code> åˆå§‹åŒ–ç¡¬ä»¶</li><li>è·å–å±å¹•å¤§å°ï¼Œå†™å…¥åˆ° <code>dispinfo</code> ç¼“å†²åŒº</li></ul></li></ul><table><thead><tr><th>å‡½æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>serial_write</code></td><td>ä¸²å£å†™å…¥</td></tr><tr><td><code>events_read</code></td><td>è¯»å–äº‹ä»¶</td></tr><tr><td><code>dispinfo_read</code></td><td>è¯»å–å±å¹•ä¿¡æ¯</td></tr><tr><td><code>fb_write</code></td><td>å†™å…¥æ˜¾å­˜</td></tr></tbody></table><h2 id=loaderc>loader.c</h2><p>åŠ è½½å™¨ã€‚</p><p>å® <code>DEFAULT_ENTRY</code> ç”¨æˆ·ç¨‹åºé»˜è®¤å…¥å£ç‚¹ã€‚</p><h3 id=å‡½æ•°-loader>å‡½æ•° loader</h3><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>static</span> <span class=n>uintptr_t</span> <span class=nf>loader</span><span class=p>(</span><span class=n>PCB</span> <span class=o>*</span><span class=n>pcb</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>filename</span><span class=p>);</span>
</code></pre></div><p>æŠŠæŒ‡å®šåç§°çš„ç”¨æˆ·ç¨‹åºåŠ è½½åˆ°æ­£ç¡®çš„å†…å­˜ä½ç½®ã€‚
ä½¿ç”¨äº† <code>fs_read</code> æ“ä½œå‡½æ•°ï¼ˆå®šä¹‰åœ¨ <code>fs.h</code> ä¸­ï¼‰</p><h3 id=å‡½æ•°-naive_uload>å‡½æ•° naive_uload</h3><p>è°ƒç”¨ <code>loader</code> åŠ è½½ç¨‹åºï¼Œå¹¶æ‰§è¡Œï¼ˆåœ¨ <code>proc.c/init_proc()</code> ä¸­ä½¿ç”¨ï¼‰ã€‚</p><h2 id=procc>proc.c</h2><p>è¿›ç¨‹ç›¸å…³ã€‚</p><h3 id=å‡½æ•°-init_proc>å‡½æ•° init_proc</h3><p>åˆå§‹åŒ–è¿›ç¨‹ã€‚</p><ul><li>è°ƒç”¨ <code>naive_uload()</code> ï¼ˆåœ¨ <code>loader.c</code> ä¸­å®šä¹‰ï¼‰ï¼ŒåŠ è½½å¹¶æ‰§è¡ŒæŒ‡å®šç¨‹åºã€‚</li></ul><h2 id=irqc>irq.c</h2><p>å®šä¹‰äº†ä¸­æ–­å¤„ç†ç›¸å…³å‡½æ•°ã€‚</p><ul><li><code>do_event()</code> æ ¹æ®ä¸Šä¸‹æ–‡å’Œäº‹ä»¶è¿›è¡Œå¤„ç†<ul><li>å°†ç³»ç»Ÿè°ƒç”¨äº‹ä»¶åˆ†å‘ç»™ <code>syscall.c</code></li></ul></li><li><code>init_irq()</code> åˆå§‹åŒ–ä¸­æ–­å¤„ç†<ul><li>è°ƒç”¨ <code>_cte_init()</code> æ³¨å†Œ <code>do_event</code> ä½œä¸ºå¤„ç†å‡½æ•°ã€‚</li></ul></li></ul><h2 id=syscallh>syscall.h</h2><p>å®šä¹‰äº†å„ç§ç³»ç»Ÿè°ƒç”¨ç±»å‹çš„ç¼–å·ã€‚</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=k>enum</span> <span class=p>{</span>
  <span class=n>SYS_exit</span><span class=p>,</span>     <span class=c1>// ä»¥æŒ‡å®šç»“æŸç é€€å‡º
</span><span class=c1></span>  <span class=n>SYS_yield</span><span class=p>,</span>    <span class=c1>// è‡ªé™·
</span><span class=c1></span>  <span class=n>SYS_open</span><span class=p>,</span>     <span class=c1>// æ‰“å¼€æ–‡ä»¶
</span><span class=c1></span>  <span class=n>SYS_read</span><span class=p>,</span>     <span class=c1>// è¯»å–æ–‡ä»¶
</span><span class=c1></span>  <span class=n>SYS_write</span><span class=p>,</span>    <span class=c1>// å†™å…¥æ–‡ä»¶
</span><span class=c1></span>  <span class=n>SYS_kill</span><span class=p>,</span>
  <span class=n>SYS_getpid</span><span class=p>,</span>
  <span class=n>SYS_close</span><span class=p>,</span>    <span class=c1>// å…³é—­æ–‡ä»¶
</span><span class=c1></span>  <span class=n>SYS_lseek</span><span class=p>,</span>    <span class=c1>// æ”¹å˜æ–‡ä»¶æµä½ç½®
</span><span class=c1></span>  <span class=n>SYS_brk</span><span class=p>,</span>      <span class=c1>// è®¾ç½® program breakï¼Œç”¨äºå †å†…å­˜ç®¡ç†
</span><span class=c1></span>  <span class=n>SYS_fstat</span><span class=p>,</span>
  <span class=n>SYS_time</span><span class=p>,</span>
  <span class=n>SYS_signal</span><span class=p>,</span>
  <span class=n>SYS_execve</span><span class=p>,</span>
  <span class=n>SYS_fork</span><span class=p>,</span>
  <span class=n>SYS_link</span><span class=p>,</span>
  <span class=n>SYS_unlink</span><span class=p>,</span>
  <span class=n>SYS_wait</span><span class=p>,</span>
  <span class=n>SYS_times</span><span class=p>,</span>
  <span class=n>SYS_gettimeofday</span>
<span class=p>};</span>
</code></pre></div><h2 id=syscallc>syscall.c</h2><h3 id=å‡½æ•°-do_syscall>å‡½æ•° do_syscall</h3><p>æ ¹æ®ä¸Šä¸‹æ–‡ï¼ˆåœ¨æ ˆä¸­ä¿å­˜ï¼‰ï¼Œæ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚
ä½¿ç”¨ <code>nexus-am/am.h</code> ä¸­çš„ GRP? å®è®¿é—®ç³»ç»Ÿè°ƒç”¨å‚æ•°ã€‚æ ¹æ®è°ƒç”¨ç±»å‹æ‰§è¡Œå¯¹åº”å‡½æ•°å¹¶å¤„ç†è¿”å›å€¼ã€‚</p><h1 id=å¼•ç”¨èµ„æ–™>å¼•ç”¨èµ„æ–™</h1><ul><li><a class=link href=https://legacy.gitbook.com/book/nju-ics/ics2018-programming-assignment/details target=_blank rel=noopener>ICS2018 PA è®²ä¹‰</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/nju/>NJU</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 StardustDL's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>