<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="基本信息 psake 是一个自动化构建工具，基于 PowerShell 构建，提供了类似 Make 的构建功能。
安装 # Set-PSRepository -Name PSGallery -InstallationPolicy Trusted Install-Module -Name psake 使用 创建 psakefile.ps1，然后使用以下命令
Invoke-psake # Get-Help Invoke-psake -full psakefile 结构    Function Description Required     Include() Call this function to have psake include the functions of another file into your script no   Properties() Call this function to set your properties no   Task() This is the main function that you write to execute a step in your build script."><title>psake</title><link rel=canonical href=https://stardustdl.github.io/posts/tools/psake/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="psake"><meta property="og:description" content="基本信息 psake 是一个自动化构建工具，基于 PowerShell 构建，提供了类似 Make 的构建功能。
安装 # Set-PSRepository -Name PSGallery -InstallationPolicy Trusted Install-Module -Name psake 使用 创建 psakefile.ps1，然后使用以下命令
Invoke-psake # Get-Help Invoke-psake -full psakefile 结构    Function Description Required     Include() Call this function to have psake include the functions of another file into your script no   Properties() Call this function to set your properties no   Task() This is the main function that you write to execute a step in your build script."><meta property="og:url" content="https://stardustdl.github.io/posts/tools/psake/"><meta property="og:site_name" content="StardustDL's Blog"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:published_time" content="2020-07-24T19:30:40+08:00"><meta property="article:modified_time" content="2020-07-24T19:30:40+08:00"><meta name=twitter:title content="psake"><meta name=twitter:description content="基本信息 psake 是一个自动化构建工具，基于 PowerShell 构建，提供了类似 Make 的构建功能。
安装 # Set-PSRepository -Name PSGallery -InstallationPolicy Trusted Install-Module -Name psake 使用 创建 psakefile.ps1，然后使用以下命令
Invoke-psake # Get-Help Invoke-psake -full psakefile 结构    Function Description Required     Include() Call this function to have psake include the functions of another file into your script no   Properties() Call this function to set your properties no   Task() This is the main function that you write to execute a step in your build script."><link rel="shortcut icon" href=/favicon.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-111573521-1','auto'),ga('send','pageview'))</script></head><body class="article-page has-toc"><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
extended"><div id=article-toolbar><a href=https://stardustdl.github.io/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/tools/>Tools</a></header><h2 class=article-title><a href=/posts/tools/psake/>psake</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Jul 24, 2020</time></footer></div></header><section class=article-content><h1 id=基本信息>基本信息</h1><p><a class=link href=https://github.com/psake/psake target=_blank rel=noopener>psake</a> 是一个自动化构建工具，基于 PowerShell 构建，提供了类似 Make 的构建功能。</p><h1 id=安装>安装</h1><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=c># Set-PSRepository -Name PSGallery -InstallationPolicy Trusted</span>
<span class=nb>Install-Module</span> <span class=n>-Name</span> <span class=n>psake</span>
</code></pre></div><h1 id=使用>使用</h1><p>创建 <code>psakefile.ps1</code>，然后使用以下命令</p><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=nb>Invoke-psake</span>

<span class=c># Get-Help Invoke-psake -full</span>
</code></pre></div><h1 id=psakefile-结构>psakefile 结构</h1><table><thead><tr><th>Function</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><em>Include()</em></td><td>Call this function to have psake include the functions of another file into your script</td><td>no</td></tr><tr><td><em>Properties()</em></td><td>Call this function to set your properties</td><td>no</td></tr><tr><td><em>Task()</em></td><td>This is the main function that you write to execute a step in your build script. NOTE: There can be only one task function that is named &ldquo;default&rdquo; in your psake script and it cannot contain any code. psake will throw an exception if it finds more than one default task function or if the default task function contains code</td><td>yes</td></tr><tr><td><em>Exec()</em></td><td>Call a command-line program and throw an exception if it returns a non-zero DOS exit code</td><td>no</td></tr><tr><td><em>Assert()</em></td><td>Use to simplify writing conditional statements</td><td>no</td></tr><tr><td><em>FormatTaskName()</em></td><td>Allows you to reformat how psake displays the currently running task</td><td>no</td></tr><tr><td><em>TaskSetup()</em></td><td>A function that will run before each task is executed</td><td>no</td></tr><tr><td><em>TaskTearDown()</em></td><td>A function that will run after each task</td><td>no</td></tr><tr><td><em>BuildSetup()</em></td><td>A script block that will run before the first task starts</td><td>no</td></tr><tr><td><em>BuildTearDown()</em></td><td>A script block that will run when either all tasks have completed, or the build has failed</td><td>no</td></tr></tbody></table><p>BNF:</p><pre><code>&lt;BuildScript&gt; ::= &lt;Includes&gt; 
                | &lt;Properties&gt;
                | &lt;FormatTaskName&gt; 
                | &lt;BuildSetup&gt; 
                | &lt;TaskSetup&gt; 
                | &lt;TaskTearDown&gt; 
                | &lt;Tasks&gt; 
&lt;Includes&gt; ::= Include &lt;StringLiteral&gt; | &lt;Includes&gt;
&lt;Properties&gt; ::= Properties &lt;ScriptBlock&gt; | &lt;Properties&gt;
&lt;FormatTaskName&gt; ::= FormatTaskName &lt;Stringliteral&gt;
&lt;BuildSetup&gt; ::= BuildSetup &lt;ScriptBlock&gt;
&lt;BuildTearDown&gt; ::= BuildTearDown &lt;ScriptBlock&gt;
&lt;TaskSetup&gt; ::= TaskSetup &lt;ScriptBlock&gt;
&lt;TaskTearDown&gt; ::= TaskTearDown &lt;ScriptBlock&gt;
&lt;Tasks&gt; ::= Task &lt;TaskParameters&gt; | &lt;Tasks&gt;
&lt;TaskParameters&gt; ::= -Name &lt;StringLiteral&gt; 
			| -Action &lt;ScriptBlock&gt; 
			| -PreAction &lt;ScriptBlock&gt; 
			| -PostAction &lt;ScriptBlock&gt; 
			| -PreCondition &lt;ScriptBlock&gt;
			| -PostCondition &lt;ScriptBlock&gt;
			| -ContinueOnError &lt;Boolean&gt;
			| -Depends &lt;TaskNames&gt;
			| -Description &lt;StringLiteral&gt;
&lt;TaskNames&gt; ::= &lt;StringLiteral&gt;, | &lt;TaskNames&gt;				
&lt;ScriptBlock&gt; ::= { &lt;PowerShellStatements&gt; }
&lt;Boolean&gt; ::= $true | $false
</code></pre><h1 id=常见模式>常见模式</h1><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=n>Task</span> <span class=k>default</span> <span class=n>-Depends</span> <span class=n>Test</span>

<span class=n>Task</span> <span class=n>Test</span> <span class=n>-Depends</span> <span class=n>Compile</span><span class=p>,</span> <span class=n>Clean</span> <span class=p>{</span>
  <span class=s2>&#34;This is a test&#34;</span>
<span class=p>}</span>

<span class=n>Task</span> <span class=n>Compile</span> <span class=n>-Depends</span> <span class=n>Clean</span> <span class=p>{</span>
  <span class=s2>&#34;Compile&#34;</span>
<span class=p>}</span>

<span class=n>Task</span> <span class=n>Clean</span> <span class=n>-ContinueOnError</span> <span class=p>{</span>
  <span class=s2>&#34;Clean&#34;</span>
<span class=p>}</span>
</code></pre></div><h1 id=传递参数和属性>传递参数和属性</h1><p>调用：</p><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=nb>Invoke-psake</span> <span class=p>.\</span><span class=n>parameters</span><span class=p>.</span><span class=n>ps1</span> <span class=n>-parameters</span> <span class=p>@{</span><span class=s2>&#34;p1&#34;</span><span class=p>=</span><span class=s2>&#34;v1&#34;</span><span class=p>;</span><span class=s2>&#34;p2&#34;</span><span class=p>=</span><span class=s2>&#34;v2&#34;</span><span class=p>}</span>
</code></pre></div><p>传递的参数会作为脚本的变量。</p><p>psakefile：</p><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=n>properties</span> <span class=p>{</span>
  <span class=nv>$my_property</span> <span class=p>=</span> <span class=nv>$p1</span> <span class=p>+</span> <span class=nv>$p2</span>
<span class=p>}</span>

<span class=n>task</span> <span class=k>default</span> <span class=n>-depends</span> <span class=n>TestParams</span>

<span class=n>task</span> <span class=n>TestParams</span> <span class=p>{</span> 
  <span class=n>Assert</span> <span class=p>(</span><span class=nv>$my_property</span> <span class=o>-ne</span> <span class=nv>$null</span><span class=p>)</span> <span class=s1>&#39;$my_property should not be null&#39;</span>  
<span class=p>}</span>
</code></pre></div><p>覆盖预定义属性：</p><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=nb>Invoke-psake</span> <span class=p>.\</span><span class=n>properties</span><span class=p>.</span><span class=n>ps1</span> <span class=n>-properties</span> <span class=p>@{</span><span class=s2>&#34;x&#34;</span><span class=p>=</span><span class=s2>&#34;1&#34;</span><span class=p>;</span><span class=s2>&#34;y&#34;</span><span class=p>=</span><span class=s2>&#34;2&#34;</span><span class=p>}</span>
</code></pre></div><h1 id=条件运行>条件运行</h1><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=n>task</span> <span class=k>default</span> <span class=n>-depends</span> <span class=n>A</span><span class=p>,</span><span class=n>B</span><span class=p>,</span><span class=n>C</span>

<span class=n>task</span> <span class=n>A</span> <span class=p>{</span>
  <span class=s2>&#34;TaskA&#34;</span>
<span class=p>}</span>

<span class=n>task</span> <span class=n>B</span> <span class=n>-precondition</span> <span class=p>{</span> <span class=k>return</span> <span class=nv>$false</span> <span class=p>}</span> <span class=p>{</span>
  <span class=s2>&#34;TaskB&#34;</span>
<span class=p>}</span>

<span class=n>task</span> <span class=n>C</span> <span class=n>-precondition</span> <span class=p>{</span> <span class=k>return</span> <span class=nv>$true</span> <span class=p>}</span> <span class=p>{</span>
  <span class=s2>&#34;TaskC&#34;</span>
<span class=p>}</span>
</code></pre></div><h1 id=导入外部脚本>导入外部脚本</h1><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=n>Include</span> <span class=s2>&#34;.\build_utils.ps1&#34;</span>
</code></pre></div><h1 id=调用命令行工具>调用命令行工具</h1><div class=highlight><pre class=chroma><code class=language-ps1 data-lang=ps1><span class=n>Exec</span> <span class=n>-maxRetries</span> <span class=n>3</span> <span class=n>-retryTriggerErrorPattern</span> <span class=s2>&#34;Service is not currently available.&#34;</span> <span class=p>{</span> <span class=n>dotnet</span> <span class=n>build</span> <span class=p>}</span>
</code></pre></div><h1 id=参考资料>参考资料</h1><ul><li><a class=link href=https://psake.readthedocs.io/en/latest/ target=_blank rel=noopener>psake Document</a></li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article><a href=/posts/tools/github-workflow/><div class=article-details><h2 class=article-title>GitHub Actions - Workflow</h2></div></a></article><article><a href=/posts/tools/proglang-dockerfile/><div class=article-details><h2 class=article-title>Dockerfile</h2></div></a></article><article class=has-image><a href=/posts/tools/proglang-yaml/><div class=article-image><img src=https://raw.githubusercontent.com/github/explore/80688e429a7d4ef2fca1e82350fe8e3517d3494d/topics/yaml/yaml.png loading=lazy data-key data-hash=https://raw.githubusercontent.com/github/explore/80688e429a7d4ef2fca1e82350fe8e3517d3494d/topics/yaml/yaml.png></div><div class=article-details><h2 class=article-title>YAML Ain't Markup Language</h2></div></a></article><article><a href=/posts/tools/gdb/><div class=article-details><h2 class=article-title>GDB - The GNU Project Debugger</h2></div></a></article><article class=has-image><a href=/posts/tools/powershell/><div class=article-image><img src=https://devblogs.microsoft.com/powershell/wp-content/uploads/sites/30/2018/09/Powershell_256.png loading=lazy data-key data-hash=https://devblogs.microsoft.com/powershell/wp-content/uploads/sites/30/2018/09/Powershell_256.png></div><div class=article-details><h2 class=article-title>PowerShell</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=StardustDL/stardustdl.github.io issue-term=pathname label=comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(b){let a=document.querySelector('.utterances iframe');a&&a.contentWindow.postMessage({type:'set-theme',theme:`github-${b}`},'https://utteranc.es')}addEventListener('message',a=>{if(a.origin!=='https://utteranc.es')return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener('onColorSchemeChange',a=>{setUtterancesTheme(a.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 StardustDL's Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.4.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#基本信息>基本信息</a></li><li><a href=#安装>安装</a></li><li><a href=#使用>使用</a></li><li><a href=#psakefile-结构>psakefile 结构</a></li><li><a href=#常见模式>常见模式</a></li><li><a href=#传递参数和属性>传递参数和属性</a></li><li><a href=#条件运行>条件运行</a></li><li><a href=#导入外部脚本>导入外部脚本</a></li><li><a href=#调用命令行工具>调用命令行工具</a></li><li><a href=#参考资料>参考资料</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>