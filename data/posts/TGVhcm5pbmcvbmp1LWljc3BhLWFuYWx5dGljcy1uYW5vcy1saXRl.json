{"Id":"Learning/nju-icspa-analytics-nanos-lite","Type":0,"AuthorId":"","Content":{"Tag":"","Raw":"\n# \u6982\u8FF0\n\n- [\u6846\u67B6\u4EE3\u7801\u5E93](https://github.com/NJU-ProjectN/nanos-lite)\n- CPU \u67B6\u6784\uFF1Ax64\n- \u64CD\u4F5C\u7CFB\u7EDF: GNU/Linux\n- \u7F16\u8BD1\u5668: GCC\n- \u7F16\u7A0B\u8BED\u8A00\uFF1AC \u8BED\u8A00\n\nNanos-lite\u662F\u5357\u4EAC\u5927\u5B66\u64CD\u4F5C\u7CFB\u7EDFNanos\u7684\u88C1\u526A\u7248\u3002\u53EF\u8FD0\u884C\u5728 x86-nemu \u7684 AM \u4E0A\u3002\n\n## \u6846\u67B6\u4EE3\u7801\u7ED3\u6784\n\n\u0060\u0060\u0060\nnanos-lite/                 # NANOS-LITE \u9879\u76EE\n    include/                # \u5934\u6587\u4EF6\n    src/                    # \u6E90\u6587\u4EF6\n        device.c            # \u8BBE\u5907\u62BD\u8C61\n        fs.c                # \u6587\u4EF6\u7CFB\u7EDF\n        files.h             # ramdisk \u4E2D\u7684\u6587\u4EF6\u63CF\u8FF0\n        initrd.S            # ramdisk\u8BBE\u5907\n        irq.c               # \u4E2D\u65AD\u5F02\u5E38\u5904\u7406\n        loader.c            # \u52A0\u8F7D\u5668\n        main.c              # \u4E3B\u7A0B\u5E8F\n        mm.c                # \u5B58\u50A8\u7BA1\u7406\n        proc.c              # \u8FDB\u7A0B\u8C03\u5EA6\n        ramdisk.c           # ramdisk\u9A71\u52A8\u7A0B\u5E8F\n        syscall.c           # \u7CFB\u7EDF\u8C03\u7528\u5904\u7406\n        syscall.h           # \u7CFB\u7EDF\u8C03\u7528\u76F8\u5173\u5B8F\n    Makefile\nnavy-apps/\nnemu/\nnexus-am/\n\u0060\u0060\u0060\n\n## \u76F8\u5173\u8D44\u6599\n\n- {% post_link solving/nju-icspa-analytics-nemu %}\n- {% post_link solving/nju-icspa-analytics-nexus-am %}\n- {% post_link solving/nju-icspa-analytics-nanos-lite %}\n- {% post_link solving/nju-icspa-analytics-navy-apps %}\n\n# include/\n\n## common.h\n\n\u5F15\u7528 AM \u4E2D\u7684 \u0060am.h klib.h\u0060\u3002\n\n## debug.h\n\n\u7B80\u5316\u8C03\u8BD5\u8F93\u51FA\u7684\u5B8F\uFF0C\u53EF\u7C7B\u6BD4 \u0060nemu/debug.h\u0060\u3002\n\n## fs.h\n\n\u6587\u4EF6\u7CFB\u7EDF\u7684\u76F8\u5173\u5185\u5BB9\u3002\n\nLSEEK \u7C7B\u578B\u679A\u4E3E\uFF1A\n\n|\u679A\u4E3E|\u63CF\u8FF0|\n|-|-|\n|\u0060SEEK_SET\u0060|\u5C06\u6587\u4EF6\u6D41\u4F4D\u7F6E\u8BBE\u7F6E\u4E3A\u6307\u5B9A\u503C|\n|\u0060SEEK_CUR\u0060|\u5C06\u6587\u4EF6\u6D41\u4F4D\u7F6E\u8BBE\u7F6E\u4E3A\u5F53\u524D\u4F4D\u7F6E\u5411\u540E\u504F\u79FB\u6307\u5B9A\u503C|\n|\u0060SEEK_END\u0060|\u5C06\u6587\u4EF6\u6D41\u4F4D\u7F6E\u8BBE\u7F6E\u6587\u4EF6\u672B\u5C3E|\n\n\u6587\u4EF6\u7CFB\u7EDF\u64CD\u4F5C\u51FD\u6570\uFF1A\n\n|\u51FD\u6570|\u63CF\u8FF0|\n|-|-|\n|\u0060fs_open\u0060|\u6253\u5F00\u6587\u4EF6\uFF0C\u8FD4\u56DE ID|\n|\u0060fs_read\u0060|\u8BFB\u53D6\u6587\u4EF6|\n|\u0060fs_write\u0060|\u5199\u5165\u6587\u4EF6|\n|\u0060fs_lseek\u0060|\u6539\u53D8\u6587\u4EF6\u6D41\u4F4D\u7F6E|\n|\u0060fs_close\u0060|\u5173\u95ED\u6587\u4EF6|\n|\u0060fs_filesz\u0060|\u83B7\u53D6\u6587\u4EF6\u5927\u5C0F|\n\n# src/\n\n## main.c\n\nNANOS-LITE \u4E3B\u7A0B\u5E8F\u3002\n\n- \u521D\u59CB\u5316\u5B58\u50A8 \uFF08\u0060init_mm\u0060\uFF09\n- \u521D\u59CB\u5316\u955C\u50CF\u6587\u4EF6 \uFF08\u0060init_ramdisk\u0060\uFF09\n- \u521D\u59CB\u5316\u8BBE\u5907 \uFF08\u0060init_device\u0060\uFF09\n- \u521D\u59CB\u5316\u4E2D\u65AD\u5904\u7406 \uFF08\u0060init_irq\u0060\uFF09\n- \u521D\u59CB\u5316\u6587\u4EF6\u7CFB\u7EDF \uFF08\u0060init_fs\u0060\uFF09\n- \u521D\u59CB\u5316\u8FDB\u7A0B \uFF08\u0060init_proc\u0060\uFF09\n    - \u4ECE \u0060ramdist\u0060 \u4E2D\u52A0\u8F7D\u7A0B\u5E8F\u955C\u50CF\u5230\u6307\u5B9A\u4F4D\u7F6E\n    - \u542F\u52A8\u8FDB\u7A0B\n- \u6D4B\u8BD5\u81EA\u9677\u4E8B\u4EF6\uFF08\u0060_yield\u0060\uFF09\n\n## ramdisk.c\n\n\u53D8\u91CF \u0060ramdisk_start,ramdisk_end\u0060 \u6307\u793A ramdisk \u6240\u5728\u7684\u5185\u5B58\u533A\u95F4\u3002\n\u5B8F \u0060RAMDISK_SIZE\u0060 \u6307\u793A ramdisk \u5BF9\u5E94\u5185\u5B58\u5927\u5C0F\u3002\n\nramdisk \u76F8\u5173\u64CD\u4F5C\u51FD\u6570\u3002\n\n\u0060\u0060\u0060c\n// \u521D\u59CB\u5316 ramdisk\nvoid init_ramdisk();\n\n// \u4ECEramdisk\u4E2D offset \u504F\u79FB\u5904\u7684 len \u5B57\u8282\u8BFB\u5165\u5230 buf \u4E2D\nsize_t ramdisk_read(void *buf, size_t offset, size_t len);\n\n// \u628A buf \u4E2D\u7684 len \u5B57\u8282\u5199\u5165\u5230ramdisk\u4E2D offset \u504F\u79FB\u5904\nsize_t ramdisk_write(const void *buf, size_t offset, size_t len);\n\n// \u8FD4\u56DEramdisk\u7684\u5927\u5C0F, \u5355\u4F4D\u4E3A\u5B57\u8282\nsize_t get_ramdisk_size();\n\u0060\u0060\u0060\n\n## fs.c\n\n\u6587\u4EF6\u7CFB\u7EDF\u76F8\u5173\u3002\u5B9E\u73B0\u4E86 \u0060fs.h\u0060 \u4E2D\u5B9A\u4E49\u7684\u51FD\u6570\u3002\n\n- \u0060init_fs\u0060 \u521D\u59CB\u5316\u6587\u4EF6\u7CFB\u7EDF\n    - \u521D\u59CB\u5316 \u0060FD_FB\u0060 \u6587\u4EF6\u7684\u5927\u5C0F\uFF08\u6839\u636E VGA \u5C4F\u5E55\u5927\u5C0F\uFF09\n\n- \u0060ReadFn\u0060 \u7C7B\u578B\uFF1AVFS \u901A\u7528\u6587\u4EF6\u8BFB\u53D6\u51FD\u6570\u7C7B\u578B\n- \u0060WriteFn\u0060 \u7C7B\u578B\uFF1AVFS \u901A\u7528\u6587\u4EF6\u5199\u5165\u51FD\u6570\u7C7B\u578B\n\n\u0060\u0060\u0060c\ntypedef size_t (*ReadFn) (void *buf, size_t offset, size_t len);\ntypedef size_t (*WriteFn) (const void *buf, size_t offset, size_t len);\n\u0060\u0060\u0060\n\n\u7528\u4E8E\u7981\u7528\u6587\u4EF6\u8BFB\u5199\u7684\u51FD\u6570\uFF1A\n\n- \u0060invalid_read\u0060 \u975E\u6CD5\u8BFB\u53D6\n- \u0060invalid_write\u0060 \u975E\u6CD5\u5199\u5165\n\n### \u679A\u4E3E\n\n\u7279\u6B8A\u6587\u4EF6\u7C7B\u578B\u679A\u4E3E\u3002\n\n|\u679A\u4E3E|\u63CF\u8FF0|\n|-|-|\n|\u0060FD_STDIN\u0060|\u6807\u51C6\u8F93\u5165|\n|\u0060FD_STDOUT\u0060|\u6807\u51C6\u8F93\u51FA|\n|\u0060FD_STDERR\u0060|\u6807\u51C6\u9519\u8BEF\u8F93\u51FA|\n|\u0060FD_FB\u0060|\u663E\u5B58|\n\n### \u7ED3\u6784\u4F53 Finfo\n\n\u6587\u4EF6\u63CF\u8FF0\u4FE1\u606F\u3002\n\n|\u6210\u5458|\u63CF\u8FF0|\n|-|-|\n|\u0060name\u0060|\u6587\u4EF6\u540D|\n|\u0060size\u0060|\u6587\u4EF6\u5927\u5C0F|\n|\u0060dist_offset\u0060|\u5728 ramdisk \u4E2D\u7684\u5730\u5740\u504F\u79FB|\n|\u0060open_offset\u0060|\u6587\u4EF6\u6D41\u4F4D\u7F6E|\n|\u0060read\u0060|\u8BFB\u53D6\u51FD\u6570|\n|\u0060write\u0060|\u5199\u5165\u51FD\u6570|\n\n- \u0060file_table\u0060 \u4FDD\u5B58\u4E86\u6240\u6709\u6587\u4EF6\u4FE1\u606F\n    - \u0060files.h\u0060 \u5B9A\u4E49\u4E86\u5728 ramdisk \u4E2D\u7684\u6587\u4EF6\n- \u0060NR_FILES\u0060 \u6587\u4EF6\u603B\u6570\n\n\u7279\u6B8A\u6587\u4EF6\uFF1A\n\n|\u6587\u4EF6\u540D|\u63CF\u8FF0|\n|-|-|\n|\u0060stdin\u0060|\u6807\u51C6\u8F93\u5165|\n|\u0060stdout\u0060|\u6807\u51C6\u8F93\u51FA|\n|\u0060stderr\u0060|\u6807\u51C6\u9519\u8BEF\u8F93\u51FA|\n|\u0060/dev/fb\u0060|\u663E\u5B58|\n|\u0060/proc/dispinfo\u0060|\u663E\u793A\u5668\u4FE1\u606F|\n|\u0060/dev/events\u0060|\u4E8B\u4EF6\uFF0C\u5305\u542B\u65F6\u949F\u548C\u952E\u76D8\u4FE1\u53F7|\n\n## device.c\n\n\u5C06\u8BBE\u5907\u62BD\u8C61\u6210\u6587\u4EF6\u7684\u5B9E\u73B0\u3002\n\n- \u0060init_device\u0060 \u521D\u59CB\u5316\u8BBE\u5907\n    - \u8C03\u7528 \u0060_ioe_init()\u0060 \u521D\u59CB\u5316\u786C\u4EF6\n    - \u83B7\u53D6\u5C4F\u5E55\u5927\u5C0F\uFF0C\u5199\u5165\u5230 \u0060dispinfo\u0060 \u7F13\u51B2\u533A\n\n|\u51FD\u6570|\u63CF\u8FF0|\n|-|-|\n|\u0060serial_write\u0060|\u4E32\u53E3\u5199\u5165|\n|\u0060events_read\u0060|\u8BFB\u53D6\u4E8B\u4EF6|\n|\u0060dispinfo_read\u0060|\u8BFB\u53D6\u5C4F\u5E55\u4FE1\u606F|\n|\u0060fb_write\u0060|\u5199\u5165\u663E\u5B58|\n\n## loader.c\n\n\u52A0\u8F7D\u5668\u3002\n\n\u5B8F \u0060DEFAULT_ENTRY\u0060 \u7528\u6237\u7A0B\u5E8F\u9ED8\u8BA4\u5165\u53E3\u70B9\u3002\n\n### \u51FD\u6570 loader\n\n\u0060\u0060\u0060c\nstatic uintptr_t loader(PCB *pcb, const char *filename);\n\u0060\u0060\u0060\n\n\u628A\u6307\u5B9A\u540D\u79F0\u7684\u7528\u6237\u7A0B\u5E8F\u52A0\u8F7D\u5230\u6B63\u786E\u7684\u5185\u5B58\u4F4D\u7F6E\u3002\n\u4F7F\u7528\u4E86 \u0060fs_read\u0060 \u64CD\u4F5C\u51FD\u6570\uFF08\u5B9A\u4E49\u5728 \u0060fs.h\u0060 \u4E2D\uFF09\n\n### \u51FD\u6570 naive_uload\n\n\u8C03\u7528 \u0060loader\u0060 \u52A0\u8F7D\u7A0B\u5E8F\uFF0C\u5E76\u6267\u884C\uFF08\u5728 \u0060proc.c/init_proc()\u0060 \u4E2D\u4F7F\u7528\uFF09\u3002\n\n## proc.c\n\n\u8FDB\u7A0B\u76F8\u5173\u3002\n\n### \u51FD\u6570 init_proc\n\n\u521D\u59CB\u5316\u8FDB\u7A0B\u3002\n- \u8C03\u7528 \u0060naive_uload()\u0060 \uFF08\u5728 \u0060loader.c\u0060 \u4E2D\u5B9A\u4E49\uFF09\uFF0C\u52A0\u8F7D\u5E76\u6267\u884C\u6307\u5B9A\u7A0B\u5E8F\u3002\n\n## irq.c\n\n\u5B9A\u4E49\u4E86\u4E2D\u65AD\u5904\u7406\u76F8\u5173\u51FD\u6570\u3002\n\n- \u0060do_event()\u0060 \u6839\u636E\u4E0A\u4E0B\u6587\u548C\u4E8B\u4EF6\u8FDB\u884C\u5904\u7406\n    - \u5C06\u7CFB\u7EDF\u8C03\u7528\u4E8B\u4EF6\u5206\u53D1\u7ED9 \u0060syscall.c\u0060\n- \u0060init_irq()\u0060 \u521D\u59CB\u5316\u4E2D\u65AD\u5904\u7406\n    - \u8C03\u7528 \u0060_cte_init()\u0060 \u6CE8\u518C \u0060do_event\u0060 \u4F5C\u4E3A\u5904\u7406\u51FD\u6570\u3002\n\n## syscall.h\n\n\u5B9A\u4E49\u4E86\u5404\u79CD\u7CFB\u7EDF\u8C03\u7528\u7C7B\u578B\u7684\u7F16\u53F7\u3002\n\n\u0060\u0060\u0060c\nenum {\n  SYS_exit,     // \u4EE5\u6307\u5B9A\u7ED3\u675F\u7801\u9000\u51FA\n  SYS_yield,    // \u81EA\u9677\n  SYS_open,     // \u6253\u5F00\u6587\u4EF6\n  SYS_read,     // \u8BFB\u53D6\u6587\u4EF6\n  SYS_write,    // \u5199\u5165\u6587\u4EF6\n  SYS_kill,\n  SYS_getpid,\n  SYS_close,    // \u5173\u95ED\u6587\u4EF6\n  SYS_lseek,    // \u6539\u53D8\u6587\u4EF6\u6D41\u4F4D\u7F6E\n  SYS_brk,      // \u8BBE\u7F6E program break\uFF0C\u7528\u4E8E\u5806\u5185\u5B58\u7BA1\u7406\n  SYS_fstat,\n  SYS_time,\n  SYS_signal,\n  SYS_execve,\n  SYS_fork,\n  SYS_link,\n  SYS_unlink,\n  SYS_wait,\n  SYS_times,\n  SYS_gettimeofday\n};\n\u0060\u0060\u0060\n\n## syscall.c\n\n### \u51FD\u6570 do_syscall\n\n\u6839\u636E\u4E0A\u4E0B\u6587\uFF08\u5728\u6808\u4E2D\u4FDD\u5B58\uFF09\uFF0C\u6267\u884C\u7CFB\u7EDF\u8C03\u7528\u3002\n\u4F7F\u7528 \u0060nexus-am/am.h\u0060 \u4E2D\u7684 GRP? \u5B8F\u8BBF\u95EE\u7CFB\u7EDF\u8C03\u7528\u53C2\u6570\u3002\u6839\u636E\u8C03\u7528\u7C7B\u578B\u6267\u884C\u5BF9\u5E94\u51FD\u6570\u5E76\u5904\u7406\u8FD4\u56DE\u503C\u3002\n\n# \u5F15\u7528\u8D44\u6599\n\n- [ICS2018 PA \u8BB2\u4E49](https://legacy.gitbook.com/book/nju-ics/ics2018-programming-assignment/details)"},"Title":"NJU ICS Programming Assignment \u4EE3\u7801\u5206\u6790 - NANOS-LITE","Category":{"Items":["Learning"]},"Keywords":{"Items":[]},"CreationTime":"2018-11-05T17:30:22+08:00","ModificationTime":"2018-11-05T17:30:22+08:00"}